<!DOCTYPE html>
<html ng-app="unicon">
	<head>
		<meta charset="utf-8" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<title>unicon</title>
		<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		<meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-title" content="unicon">
<link href='http://fonts.googleapis.com/css?family=Rancho' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Gudea:400,700' rel='stylesheet' type='text/css'>
		
		<link rel="stylesheet" type="text/css" href="css/index.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/plugins.css" />
	</head>
	<body ng-controller="CreateCtrl">
		<div class="innerWrap">
			<form method="get" data-ajax="true" action="http://kaz.kochab.uberspace.de/MP3/api/jam/create">
			<div id="createForm">
				<div class="item">
				<label for="name">Name:</label>
				<input type="text" placeholder="Enter jamname" id="name" name="name" ng-model="jam.name" >
				</div>

				<div class="item">
				<label for="description">description:</label>
				<textarea placeholder="description"name="description" id="description" ng-model="jam.description" ></textarea>
				</div>

				<div class="item">
					<label for="genre">Genre:</label> 
					<input type="hidden" name="genre_id" ng-model="jam.genre_id">
					<!-- <button class="item item-radio nomarg" ng-repeat="genre in genres" data-id="{{genre.id}}">
						<div class="item-content" style="background: url(http://kaz.kochab.uberspace.de/MP3/images/{{genre.image}}) left top no-repeat;">
							{{genre.name}}
						</div>
					</button> -->
				</div>

				<div class="item">
				<label for="lat">lat:</label> 
				<input type="text" name="lat" placeholder="Enter lat" id="lat" value="49.877553" ng-model="jam.lat" />
				<input type="text" name="lng" placeholder="Enter lng" id="lng" value="8.652589" ng-model="jam.lng"  />
				<div id="map"></div>
				</div>


				<div class="item">
					<label for="max_distance">max_distance:</label> 
					<input type="number" name="max_distance" placeholder="Enter max_distance" id="max_distance" ng-model="jam.max_distance" /><br>
				</div>

				<div class="item">
				<label for="max_user">max_user:</label> 
				<input type="number" name="max_user" placeholder="Enter max_user" id="max_user"/><br>
				</div>

				<div class="item">
				<label for="startDate">datetime:</label> 
				<input type="datetime-local" name="startDate" id="startDate" ng-model="jam.startDate"/>
				</div>

				<div class="item overview">
				<button ng-click="update()">update</button>
				</div>
			</div>
				<!-- <input type="submit" value="Send jam"> -->
			</form>
			<div id="returnData"></div>
		</div>
		

		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.11/angular.min.js"></script>

		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
		<script type="text/javascript" src="http://kaz.kochab.uberspace.de/MP3-unicon/unicon/www/js/plugins.js"></script>
		<!---<script type="text/javascript" src="http://kaz.kochab.uberspace.de/MP3-unicon/unicon/www/js/bufferloader.js"></script>
		<script type="text/javascript" src="http://kaz.kochab.uberspace.de/MP3-unicon/unicon/www/js/socket.io.js"></script>
		<script type="text/javascript" src="js/services.js"></script>
-->

        <script src="js/angularjs-geolocation.min.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/controller_create.js"></script>
		<!---<script type="text/javascript" src="js/index.js"></script>-->




		<script type="text/javascript" src="js/index.js"></script>
		<script type="text/javascript">
$.fn.serializeObject=function(){"use strict";var a={},b=function(b,c){var d=a[c.name];"undefined"!=typeof d&&d!==null?$.isArray(d)?d.push(c.value):a[c.name]=[d,c.value]:a[c.name]=c.value};return $.each(this.serializeArray(),b),a};

			var onSuccess = function(position) {
				console.log(position);
				$('#lat').attr('value', position.coords.latitude);
				$('#lng').attr('value', position.coords.longitude);
				initialize();
			};

			// onError Callback receives a PositionError object
			//
			function onError(error) {
			alert('code: '    + error.code    + '\n' +
			'message: ' + error.message + '\n');
			}


			function reinitSlider(dragOption){
				var slide = owl.data('owlCarousel').currentItem;
				owl.data('owlCarousel').reinit({touchDrag: dragOption, mouseDrag: dragOption});
				owl.data('owlCarousel').goTo(slide);
			}

			function initialize() {
				var $latitude = $('#lat');
				var $longitude = $('#lng');
				var latitude = $latitude.val();
				var longitude = $longitude.val();
				console.log(latitude, longitude);
				var zoom = 14;

				var LatLng = new google.maps.LatLng(latitude, longitude);

				var mapOptions = {
					zoom: zoom,
					center: LatLng,
					panControl: false,
					zoomControl: true,
					scaleControl: true,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				}  

				var map = new google.maps.Map(document.getElementById('map'),mapOptions);

				var marker = new google.maps.Marker({
					position: LatLng,
					map: map,
					title: 'Drag Me!',
					draggable: true
				});

				google.maps.event.addListener(marker, 'dragstart', function(marker){
					console.log('dragStart');
				});

				google.maps.event.addListener(marker, 'dragend', function(marker){
					console.log('dragend');
				var latLng = marker.latLng;
					$latitude.value = latLng.lat();
					$longitude.value = latLng.lng();
				});

			}
			initialize();




			var owl;

			$(document).ready(function(){
				navigator.geolocation.getCurrentPosition(onSuccess, onError);

				$("form[data-ajax=true]").submit(function(e) {
					console.log($(this));
					console.log($(this).serializeObject());

					var form_data = $(this).serializeObject();
					var form_url = $(this).attr("action");
					var form_method = $(this).attr("method").toUpperCase();
		  		
			  		$.ajax({
						type: "POST",
						dataType: "html",
						url: form_url,
						data: {
							returnFormat: "plain",
							formData: JSON.stringify(form_data),
						},
						success: function(data){
							alert('success');
							console.log(data);
							$('#returnData').html(data);
						}
					});
					e.preventDefault();
				});

				owl = $("#createForm");
	 
				owl.owlCarousel({
					navigation : true,
					navigationText: ['<','>'],
					pagination: false,
					slideSpeed : 300,
					paginationSpeed : 400,
					singleItem:true,
					rewindSpeed: 300,
					addClassActive: true,
					autoHeight : false,
					afterMove: function(e){
						console.log(e);
						
						console.log(owl.data('owlCarousel').currentItem);
					}		
				});

			});
		</script>
		
	</body>
</html>
